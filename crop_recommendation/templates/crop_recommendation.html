{% extends 'base.html' %}

{% block content %}

<div class="container mt-5">
    <h2>Crop Recommendation</h2>
    <form id="cropForm">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit" class="btn btn-success">Submit</button>
    </form>
</div>

<!-- Include jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    // Enable jQuery's noConflict mode
    var $j = jQuery.noConflict();

    console.log("jQuery version: " + $j.fn.jquery);
</script>

<!-- FontAwesome CDN (optional, used for icons) -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">

<!-- Bootstrap CSS (for modal) -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

<!-- Modal HTML -->
<div class="modal fade" id="resultModal" tabindex="-1" aria-labelledby="resultModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="resultModalLabel">Recommended Crop</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p id="cropRecommendation"></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Pop-up Script -->
<script>
    $j(document).ready(function() {
        $j('#cropForm').on('submit', function(event) {
            event.preventDefault(); // Prevent the default form submission
            $j.ajax({
                url: "{% url 'crop_recommendation_index' %}", // The view handling the AJAX request
                method: "POST",
                data: $j(this).serialize(), // Serialize the form data
                success: function(data) {
                    // Update the modal content with the recommended crop
                    $j('#cropRecommendation').text(data.recommended_crop);
                    // Show the modal
                    $j('#resultModal').modal('show');
                },
                error: function(xhr, status, error) {
                    alert("An error occurred: " + error); // Error handling
                }
            });
        });
    });
</script>

<!-- Bootstrap JS (for modal functionality) -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>

{% include 'footer.html' %}

{% endblock %}
